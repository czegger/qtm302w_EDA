---
title: "QTM 302W EDA Code Notebook Draft"
author: "Claire Zegger, Rashmi Raveendran, Yvette Addo"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Introduction

In this exploratory analysis, we examined the 2020 Social Determinants of Health (SDOH) dataset. This dataset was assembled by the Agency for Healthcare Research and Quality, which falls under jurisdiction of the US Department of Health and Human Services. The data itself is sourced from a variety of nationwide surveys such as the US Census and the PLACES dataset (collected by the Center for Disease Control). The types of variables included in this dataset fall into 5 main categories:

1.  Social Context = demographics, socioeconomic status
2.  Economic Context = employment, income
3.  Education = level of education, literacy
4.  Infrastructure = food accessibility, housing
5.  Healthcare Context = insurance, distance to healthcare facilities

We decided to center our analysis around healthcare context by investigating how private healthcare insurance coverage varies with two other determinants of health: social context and education.

## Setup

```{r}
## obtain data set
sdoh <- read.csv("data/sdohc.csv")

## load packages for analysis
library(tidyverse)
library(ggplot2)
```

## Data Cleaning

```{r}
# drop rows with NA values in variables of interest 
sdoh <- sdoh %>%
  drop_na(ACS_PCT_PRIVATE_ANY) %>% ## % pop. w/private health insurance
  drop_na(COUNTY)
```

## Examining private insurance variable

### Summary Statistics

```{r}
# calculate summary statistics for % pop. w/private health insurance variable
summary(sdoh$ACS_PCT_PRIVATE_ANY)
```

### Health insurance distribution

```{r, echo=FALSE}
# visualize distribution of insurance coverage in US by county
ggplot(sdoh, aes(x=ACS_PCT_PRIVATE_ANY)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with private health insurance")+
  ylab("number of counties")+
  ggtitle("Distribution of private health insurance coverage by county in the US")+
  theme_minimal()
```

### Counties with highest and lowest insurance coverage

```{r}
# create vector with counties and insurance
keep <- c("COUNTY", "ACS_PCT_PRIVATE_ANY")

# create new data frame with selected variables
insurance_df <- sdoh[keep]

# sort data in descending order by insurance coverage
insurance_df <- insurance_df %>%
  arrange(desc(ACS_PCT_PRIVATE_ANY))
  
# view top 5 counties with highest insurance coverage
head(insurance_df)

```

```{r}
# sort data in ascending order by insurance coverage
insurance_df <- insurance_df %>%
  arrange(ACS_PCT_PRIVATE_ANY)

# view top 5 counties with lowest insurance coverage
head(insurance_df)
```

# Relationships with other variables

## 1: Limited English Speaking

### Summary statistics for % of population from limited English-speaking households

```{r}
# summary statistics for % of limited English-speaking households
summary(sdoh$ACS_PCT_HH_LIMIT_ENGLISH)
```

### Graphing the relationship

```{r, echo = FALSE}
# correlation between limited English-speaking and private insurance coverage
ggplot(sdoh, aes(x = ACS_PCT_HH_LIMIT_ENGLISH, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'blue',alpha = 0.5, size = 2) +
  xlab("% of limited English-speaking households") +
  ylab("% of population with private insurance")+
  ggtitle("Association between English-speaking and private insurance ownership")+
  theme_minimal()
```

### Correlation Coefficient

```{r}
## calculate correlation coefficient 
cor(sdoh$ACS_PCT_HH_LIMIT_ENGLISH, sdoh$ACS_PCT_PRIVATE_ANY)
```

## 2: Various Education Levels/Degrees

### Distribution of Education Variables by County

```{r}
# visualize distribution of education level in US by county
ggplot(sdoh, aes(x=ACS_PCT_LT_HS)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with Less than High School Diploma")+
  ylab("number of counties")+
  ggtitle("Distribution of those with less than high school education by county in the US")+
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_HS_GRADUATE)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with Only High School Diploma")+
  ylab("number of counties")+
  ggtitle("Distribution of those with only a high school diploma by county in the US")+
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_BACHELOR_DGR)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with a Bachelor's Degree")+
  ylab("number of counties")+
  ggtitle("Distribution of those with a Bachelor's degree by county in the US")+
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_GRADUATE_DGR)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with a Graduate or Professional Degree")+
  ylab("number of counties")+
  ggtitle("Distribution of those with a Graduate or Professional Degree by county in the US")+
  theme_minimal()
```

### Summary statistics for % of population with various education levels

```{r}
{
  cat("\n % of Population with Less than High School Diploma\n")
  print(summary(sdoh$ACS_PCT_LT_HS))

  cat("\n % of Population with Only High School Diploma\n")
  print(summary(sdoh$ACS_PCT_HS_GRADUATE))

  cat("\n % of Population with a Bachelor's Degree\n")
  print(summary(sdoh$ACS_PCT_BACHELOR_DGR))

  cat("\n % of Population with a Graduate or Professional Degree\n")
  print(summary(sdoh$ACS_PCT_GRADUATE_DGR))
}
```

### Graphing the relationship

```{r}
ggplot(sdoh, aes(x = ACS_PCT_LT_HS, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'green',alpha = 0.5, size = 2) +
  xlab("% of Population with Less than High School Education") +
  ylab("% of Population with Private Insurance")+
  ggtitle("Association between Education and Private Insurance Ownership")+
  theme_minimal()

ggplot(sdoh, aes(x = ACS_PCT_HS_GRADUATE, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'blue', alpha = 0.5, size = 2) +
  xlab("% of Population with Only High School Diploma") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education and Private Insurance Ownership") +
  theme_minimal()

ggplot(sdoh, aes(x = ACS_PCT_BACHELOR_DGR, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'red', alpha = 0.5, size = 2) +
  xlab("% of Population with a Bachelor's Degree") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education and Private Insurance Ownership") +
  theme_minimal()

ggplot(sdoh, aes(x = ACS_PCT_GRADUATE_DGR, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'purple', alpha = 0.5, size = 2) +
  xlab("% of Population with a Graduate or Professional Degree") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education and Private Insurance Ownership") +
  theme_minimal()
```

```{r}
# Reshape data from wide to long format for plotting
sdoh_long <- sdoh %>%
  select(ACS_PCT_LT_HS, ACS_PCT_HS_GRADUATE, ACS_PCT_BACHELOR_DGR, ACS_PCT_GRADUATE_DGR, ACS_PCT_PRIVATE_ANY) %>%
  pivot_longer(cols = c(ACS_PCT_LT_HS, ACS_PCT_HS_GRADUATE, ACS_PCT_BACHELOR_DGR, ACS_PCT_GRADUATE_DGR),
               names_to = "Education_Level",
               values_to = "Education_Percentage")

# Rename factor levels for better legend labels
sdoh_long$Education_Level <- factor(sdoh_long$Education_Level, 
                                    levels = c("ACS_PCT_LT_HS", "ACS_PCT_HS_GRADUATE", "ACS_PCT_BACHELOR_DGR", "ACS_PCT_GRADUATE_DGR"),
                                    labels = c("Less than High School", "High School Diploma", "Bachelor's Degree", "Graduate Degree"))

# Create the ggplot (without scatter points, only lines)
ggplot(sdoh_long, aes(x = Education_Percentage, y = ACS_PCT_PRIVATE_ANY, color = Education_Level)) +
  geom_smooth(method = "loess", se = FALSE, linetype = "solid", size = 1) +  # Only smooth trend lines
  xlab("% of Population with Education Level") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education Levels and Private Insurance Ownership") +
  theme_minimal() +
  scale_color_manual(values = c("green", "blue", "red", "purple")) +  # Assign colors to education levels
  theme(legend.title = element_blank())
```

### Correlation Coefficient

```{r}
{
  cat("\n % of Population with Less than High School Education\n")
  print(cor(sdoh$ACS_PCT_LT_HS, sdoh$ACS_PCT_PRIVATE_ANY))

  cat("\n % of Population with Only High School Diploma\n")
  print(cor(sdoh$ACS_PCT_HS_GRADUATE, sdoh$ACS_PCT_PRIVATE_ANY))

  cat("\n % of Population with a Bachelor's Degree\n")
  print(cor(sdoh$ACS_PCT_BACHELOR_DGR, sdoh$ACS_PCT_PRIVATE_ANY))

  cat("\n % of Population with a Graduate or Professional Degree\n")
  print(cor(sdoh$ACS_PCT_GRADUATE_DGR, sdoh$ACS_PCT_PRIVATE_ANY))
}
```
