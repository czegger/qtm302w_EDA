---
title: "QTM 302W EDA Code Notebook Draft"
author: "Claire Zegger, Rashmi Raveendran, Yvette Addo"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#### INSERT HERE: A rough introduction written that provides context on your datasets provenance and motivates your analysis. 

## Setup

```{r}
## obtain data set
sdoh <- read.csv("data/SDOH_2020_COUNTY_1_0.csv")

## load packages for analysis
library(tidyverse)
library(ggplot2)
library(plotly)
```

## Data Cleaning

```{r}
# drop rows with NA values in variables of interest 
sdoh <- sdoh %>%
  drop_na(ACS_PCT_PRIVATE_ANY) %>% ## % pop. w/private health insurance
  drop_na(COUNTY)
```

## Examining private insurance variable

### Summary Statistics

```{r}
# calculate summary statistics for % pop. w/private health insurance variable
summary(sdoh$ACS_PCT_PRIVATE_ANY)
```

### Health insurance distribution

```{r, echo=FALSE}
# visualize distribution of insurance coverage in US by county
ggplot(sdoh, aes(x=ACS_PCT_PRIVATE_ANY)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with private health insurance")+
  ylab("number of counties")+
  ggtitle("Distribution of private health insurance coverage by county in the US")+
  theme_minimal()
```

### Counties with highest and lowest insurance coverage

```{r}
# create vector with counties and insurance
keep <- c("COUNTY", "ACS_PCT_PRIVATE_ANY")

# create new data frame with selected variables
insurance_df <- sdoh[keep]

# sort data in descending order by insurance coverage
insurance_df <- insurance_df %>%
  arrange(desc(ACS_PCT_PRIVATE_ANY))
  
# view top 5 counties with highest insurance coverage
head(insurance_df)

```

```{r}
# sort data in ascending order by insurance coverage
insurance_df <- insurance_df %>%
  arrange(ACS_PCT_PRIVATE_ANY)

# view top 5 counties with lowest insurance coverage
head(insurance_df)
```

# Relationships with other variables

## 1: Limited English Speaking

### Summary statistics for % of population from limited English-speaking households

```{r}
# summary statistics for % of limited English-speaking households
summary(sdoh$ACS_PCT_HH_LIMIT_ENGLISH)
```

### Graphing the relationship

```{r, echo = FALSE}
# correlation between limited English-speaking and private insurance coverage
ggplot(sdoh, aes(x = ACS_PCT_HH_LIMIT_ENGLISH, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'blue',alpha = 0.5, size = 2) +
  xlab("% of limited English-speaking households") +
  ylab("% of population with private insurance")+
  ggtitle("Association between English-speaking and private insurance ownership")+
  theme_minimal()
```

### Correlation Coefficient

```{r} 
## calculate correlation coefficient 
cor(sdoh$ACS_PCT_HH_LIMIT_ENGLISH, sdoh$ACS_PCT_PRIVATE_ANY)
```


## 2: Various Education Levels/Degrees 

### Distribution of Education Variables by County 
```{r}
# visualize distribution of education level in US by county
ggplot(sdoh, aes(x=ACS_PCT_LT_HS)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with Less than High School Diploma")+
  ylab("number of counties")+
  ggtitle("Distribution of those with less than high school education by county in the US")+
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_HS_GRADUATE)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with Only High School Diploma")+
  ylab("number of counties")+
  ggtitle("Distribution of those with only a high school diploma by county in the US")+
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_BACHELOR_DGR)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with a Bachelor's Degree")+
  ylab("number of counties")+
  ggtitle("Distribution of those with a Bachelor's degree by county in the US")+
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_GRADUATE_DGR)) + 
  geom_histogram(color = "grey", fill = "light blue")+
  xlab("% of county population with a Graduate or Professional Degree")+
  ylab("number of counties")+
  ggtitle("Distribution of those with a Graduate or Professional Degree by county in the US")+
  theme_minimal()
```


### Summary statistics for % of population with various education levels 

```{r}
{
  cat("\n % of Population with Less than High School Diploma\n")
  print(summary(sdoh$ACS_PCT_LT_HS))

  cat("\n % of Population with Only High School Diploma\n")
  print(summary(sdoh$ACS_PCT_HS_GRADUATE))

  cat("\n % of Population with a Bachelor's Degree\n")
  print(summary(sdoh$ACS_PCT_BACHELOR_DGR))

  cat("\n % of Population with a Graduate or Professional Degree\n")
  print(summary(sdoh$ACS_PCT_GRADUATE_DGR))
}
```

### Graphing the relationship

```{r}
ggplot(sdoh, aes(x = ACS_PCT_LT_HS, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'green',alpha = 0.5, size = 2) +
  xlab("% of Population with Less than High School Education") +
  ylab("% of Population with Private Insurance")+
  ggtitle("Association between Education and Private Insurance Ownership")+
  theme_minimal()

ggplot(sdoh, aes(x = ACS_PCT_HS_GRADUATE, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'blue', alpha = 0.5, size = 2) +
  xlab("% of Population with Only High School Diploma") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education and Private Insurance Ownership") +
  theme_minimal()

ggplot(sdoh, aes(x = ACS_PCT_BACHELOR_DGR, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'red', alpha = 0.5, size = 2) +
  xlab("% of Population with a Bachelor's Degree") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education and Private Insurance Ownership") +
  theme_minimal()

ggplot(sdoh, aes(x = ACS_PCT_GRADUATE_DGR, y = ACS_PCT_PRIVATE_ANY)) +
  geom_point(color = 'purple', alpha = 0.5, size = 2) +
  xlab("% of Population with a Graduate or Professional Degree") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education and Private Insurance Ownership") +
  theme_minimal()
```

```{r}
# Reshape data from wide to long format for plotting
sdoh_long <- sdoh %>%
  select(ACS_PCT_LT_HS, ACS_PCT_HS_GRADUATE, ACS_PCT_BACHELOR_DGR, ACS_PCT_GRADUATE_DGR, ACS_PCT_PRIVATE_ANY) %>%
  pivot_longer(cols = c(ACS_PCT_LT_HS, ACS_PCT_HS_GRADUATE, ACS_PCT_BACHELOR_DGR, ACS_PCT_GRADUATE_DGR),
               names_to = "Education_Level",
               values_to = "Education_Percentage")

# Rename factor levels for better legend labels
sdoh_long$Education_Level <- factor(sdoh_long$Education_Level, 
                                    levels = c("ACS_PCT_LT_HS", "ACS_PCT_HS_GRADUATE", "ACS_PCT_BACHELOR_DGR", "ACS_PCT_GRADUATE_DGR"),
                                    labels = c("Less than High School", "High School Diploma", "Bachelor's Degree", "Graduate Degree"))

# Create the ggplot (without scatter points, only lines)
ggplot(sdoh_long, aes(x = Education_Percentage, y = ACS_PCT_PRIVATE_ANY, color = Education_Level)) +
  geom_smooth(method = "loess", se = FALSE, linetype = "solid", size = 1) +  # Only smooth trend lines
  xlab("% of Population with Education Level") +
  ylab("% of Population with Private Insurance") +
  ggtitle("Association between Education Levels and Private Insurance Ownership") +
  theme_minimal() +
  scale_color_manual(values = c("green", "blue", "red", "purple")) +  # Assign colors to education levels
  theme(legend.title = element_blank())
```

### Correlation Coefficient 
```{r}
{
  cat("\n % of Population with Less than High School Education\n")
  print(cor(sdoh$ACS_PCT_LT_HS, sdoh$ACS_PCT_PRIVATE_ANY))

  cat("\n % of Population with Only High School Diploma\n")
  print(cor(sdoh$ACS_PCT_HS_GRADUATE, sdoh$ACS_PCT_PRIVATE_ANY))

  cat("\n % of Population with a Bachelor's Degree\n")
  print(cor(sdoh$ACS_PCT_BACHELOR_DGR, sdoh$ACS_PCT_PRIVATE_ANY))

  cat("\n % of Population with a Graduate or Professional Degree\n")
  print(cor(sdoh$ACS_PCT_GRADUATE_DGR, sdoh$ACS_PCT_PRIVATE_ANY))
}
```



#Gaining knowledge about the relationship between private insurance coverage and racial demographics might help one better understand more general trends in healthcare equity and accessibility.  We can investigate if some racial groups are more likely to have private insurance while others may depend on public programs or go without insurance by examining this link. The analysis that follows looks at the relationship between private insurance coverage and racial demographics, offering a data-driven viewpoint on how racial differences could affect access to healthcare.


## 3. Various Racial Groups

### Distribution of Racial Groups across county
```{r}
#visualization of each racial group in percentage for counties
ggplot(sdoh, aes(x=ACS_PCT_WHITE)) + 
  geom_histogram(color = "grey", fill = "lightblue", bins = 30) +
  xlab("% of county population identifying as White") +
  ylab("Number of counties") +
  ggtitle("Distribution of White Population by County in the US") +
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_BLACK)) + 
  geom_histogram(color = "grey", fill = "lightblue", bins = 30) +
  xlab("% of county population identifying as Black") +
  ylab("Number of counties") +
  ggtitle("Distribution of Black Population by County in the US") +
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_ASIAN)) + 
  geom_histogram(color = "grey", fill = "lightblue", bins = 30) +
  xlab("% of county population identifying as Asian") +
  ylab("Number of counties") +
  ggtitle("Distribution of Asian Population by County in the US") +
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_AIAN)) + 
  geom_histogram(color = "grey", fill = "lightblue", bins = 30) +
  xlab("% of county population identifying as American Indian/Alaska Native (AIAN)") +
  ylab("Number of counties") +
  ggtitle("Distribution of AIAN Population by County in the US") +
  theme_minimal()

ggplot(sdoh, aes(x=ACS_PCT_MULT_RACE)) + 
  geom_histogram(color = "grey", fill = "lightblue", bins = 30) +
  xlab("% of county population identifying as Multiracial") +
  ylab("Number of counties") +
  ggtitle("Distribution of Multiracial Population by County in the US") +
  theme_minimal()

```

### Summary statistics for the percentage of each racial group
```{r}
{
  cat("\n % of Population Identifying as White\n")
  print(summary(sdoh$ACS_PCT_WHITE))

  cat("\n % of Population Identifying as Black\n")
  print(summary(sdoh$ACS_PCT_BLACK))

  cat("\n % of Population Identifying as Asian\n")
  print(summary(sdoh$ACS_PCT_ASIAN))

  cat("\n % of Population Identifying as American Indian/Alaska Native (AIAN)\n")
  print(summary(sdoh$ACS_PCT_AIAN))

  cat("\n % of Population Identifying as Multiracial\n")
  print(summary(sdoh$ACS_PCT_MULT_RACE))
}

```

### Graphing the relationship between Private insurance and each racial group
```{r}
#selecting the racial variables, county and private insurance
selected_racial_group_with_county <- sdoh %>%
  select(COUNTY, ACS_PCT_WHITE, ACS_PCT_BLACK, ACS_PCT_ASIAN, ACS_PCT_AIAN, ACS_PCT_MULT_RACE, ACS_PCT_PRIVATE_ANY)

selected_racial_group_with_county

# Identify top 5 counties with highest private insurance coverage
top_counties <- selected_racial_group_with_county %>%
  arrange(desc(ACS_PCT_PRIVATE_ANY)) %>%
  slice(1:5)

top_counties

# Convert race columns into long format for visualization
selected_long <- top_counties %>%
  pivot_longer(cols = c(ACS_PCT_WHITE, ACS_PCT_BLACK, ACS_PCT_ASIAN, ACS_PCT_AIAN, ACS_PCT_MULT_RACE),
               names_to = "Race",
               values_to = "Percentage")

selected_long


# Creating an interactive bar plot
p <- ggplot(selected_long, aes(x = Race, y = Percentage, fill = Race, 
                               text = paste("County:", COUNTY, 
                                            "<br>Private Insurance:", round(ACS_PCT_PRIVATE_ANY, 2)))) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ COUNTY, scales = "free_y") +  # Facet by County only
  labs(title = "Race Distribution in Top 5 Counties with Highest Private Insurance",
       x = NULL,  # Removes x-axis label to avoid repetition
       y = "Percentage of Population") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Removes race labels at the bottom
        axis.ticks.x = element_blank(),
        strip.text = element_text(size = 10, face = "bold"),  # Adjust facet title size
        legend.position = "bottom")  # Moves legend to bottom

# Convert to interactive plotly graph
interactive_plot <- ggplotly(p, tooltip = "text")

interactive_plot
```


### Correlation Coefficient between private insurance and racial groups
```{r}
{
  cat("\nCorrelation: % White vs. Private Insurance\n")
  print(cor(sdoh$ACS_PCT_WHITE, sdoh$ACS_PCT_PRIVATE_ANY, use = "complete.obs"))

  cat("\nCorrelation: % Black vs. Private Insurance\n")
  print(cor(sdoh$ACS_PCT_BLACK, sdoh$ACS_PCT_PRIVATE_ANY, use = "complete.obs"))

  cat("\nCorrelation: % Asian vs. Private Insurance\n")
  print(cor(sdoh$ACS_PCT_ASIAN, sdoh$ACS_PCT_PRIVATE_ANY, use = "complete.obs"))

  cat("\nCorrelation: % American Indian/Alaska Native vs. Private Insurance\n")
  print(cor(sdoh$ACS_PCT_AIAN, sdoh$ACS_PCT_PRIVATE_ANY, use = "complete.obs"))

  cat("\nCorrelation: % Multiracial vs. Private Insurance\n")
  print(cor(sdoh$ACS_PCT_MULT_RACE, sdoh$ACS_PCT_PRIVATE_ANY, use = "complete.obs"))
}
```


